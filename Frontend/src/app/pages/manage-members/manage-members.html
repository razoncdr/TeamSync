
<div class="members-container">
  <h2>Project Members - {{ projectName }}</h2>

  <!-- <button class="back-btn" routerLink="/dashboard">â¬… Back</button> -->

  <!-- Member List -->
  <div *ngIf="loading">Loading members...</div>

  <table *ngIf="!loading">
    <tr>
      <th>Username</th>
      <th>Email</th>
      <th>Role</th>
      <th>Joined</th>
      <th>Action</th>
    </tr>

    <tr *ngFor="let m of members">
      <td>{{ m.name }}</td>
      <td>{{ m.email }}</td>
      <td>
        <span
          [ngClass]="{
            'badge-owner': m.role === 'Owner',
            'badge-admin': m.role === 'Admin',
            'badge-editor': m.role === 'Editor',
            'badge-viewer': m.role === 'Viewer'
          }"
          >{{ m.role }}</span
        >
      </td>
      <td>{{ m.joinedAt | date }}</td>
      <td>
        <button class="remove-btn" (click)="removeMember(m.userId)">Remove</button>
      </td>
    </tr>
  </table>

  <hr />

  <!-- Invite Form -->
  <h3>Invite New Member</h3>

  <input type="email" placeholder="Email address" [(ngModel)]="inviteEmail" />

  <select [(ngModel)]="inviteRole">
    <option value="Viewer">Viewer</option>
    <option value="Editor">Editor</option>
    <option value="Admin">Admin</option>
  </select>

  <button (click)="invite()" [disabled]="inviting">
    {{ inviting ? 'Sending...' : 'Send Invite' }}
  </button>
</div>
<hr />

<!-- Pending Invitations -->
<h3>Invitations</h3>

<div *ngIf="loadingInvitations">Loading invitations...</div>

<table *ngIf="!loadingInvitations && invitations.length > 0">
  <tr>
    <th>Email</th>
    <th>Role</th>
    <th>Status</th>
    <th>Sent At</th>
    <th>Action</th>
  </tr>
  <tr *ngFor="let inv of invitations">
    <td>{{ inv.invitedEmail }}</td>
    <td>
      <span
        [ngClass]="{
          'badge-owner': inv.role === 'Owner',
          'badge-admin': inv.role === 'Admin',
          'badge-editor': inv.role === 'Editor',
          'badge-viewer': inv.role === 'Viewer'
        }"
        >{{ inv.role }}</span
      >
    </td>
    <td>
      <span
        [ngClass]="{
          'badge-pending': inv.status === 'Pending',
          'badge-accepted': inv.status === 'Accepted',
          'badge-rejected': inv.status === 'Rejected'
        }"
      >
        {{ inv.status }}
      </span>
    </td>
    <td>{{ inv.createdAt | date : 'short' }}</td>
    <td *ngIf="inv.status === 'Pending'">
      <button class="remove-btn" (click)="cancelInvitation(inv.id)">Cancel</button>
    </td>
  </tr>
</table>

<div *ngIf="!loadingInvitations && invitations.length === 0">No invitations.</div>
